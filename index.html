<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | BlocksWorld</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="TemplateData/aws-sdk-2.709.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
    <script src="TemplateData/fingerpose.js" type="text/javascript"></script>
    <script src="TemplateData/fingerpose-adapter.js" type="text/javascript"></script>
</head>
<body>
    <button type="button" id="start-btn" disabled>Loading...</button><br>
    <input type="checkbox" id="engage-chk" style="display:none;" />
    <label for="show-gesture"><input type="checkbox" id="show-gesture" name="show-gesture" /> Show Video</label>
    <label for="show-datastore"><input type="checkbox" id="show-datastore" name="show-datastore" /> Show Datastore</label>
    <label for="use-gesture"><input type="checkbox" id="use-gesture" name="use-gesture" checked /> Enable Gesture Input</label>
    <label for="use-gesture"><input type="checkbox" id="use-key" name="use-key" checked /> Enable Keyboard Input</label>
    <div class="scenes">
        <button type="button" id="sort-btn">Sort Toys</button><br>
        <button type="button" id="gesture-btn">Gesture Elicitation</button><br>
        <button type="button" id="grooving-btn">Grooving</button><br>
    </div>
    <div class="contact">For questions or comments, contact fortega@colostate.edu</div>
    <div class="controls">If Keyboard Input is enabled, use the Left Arrow Key to send a toy to the left and use the Right Arrow Key to send a toy to the right. Press the Up Arrow Key to wave.</div>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-mobile-warning">
            WebGL builds are not supported on mobile devices.
        </div>
        <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title">BlocksWorld</div>
        </div>
    </div>
    <script>
      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/c4c07f153778d8abf1842ac44b3ff052.js";
      var config = {
        dataUrl: buildUrl + "/e0c8a54272cad4c2056253d3ea83d2ac.data",
        frameworkUrl: buildUrl + "/073c1825f5275d550b541e3ba6287e65.js",
        codeUrl: buildUrl + "/e09f095656f9f8db0631c19d54c8ce66.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "CwC CSU",
        productName: "BlocksWorld",
        productVersion: "0.1",
      };

      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");
      var mobileWarning = document.querySelector("#unity-mobile-warning");

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
        config.devicePixelRatio = 1;
        mobileWarning.style.display = "block";
        setTimeout(() => {
          mobileWarning.style.display = "none";
        }, 5000);
      } else {
        canvas.style.width = "960px";
        canvas.style.height = "600px";
      }
      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
          loadingBar.style.display = "none";
          fullscreenButton.onclick = () => {
            unityInstance.SetFullscreen(1);
          };
          startPerception();
        }).catch((message) => {
          alert(message);
        });
      };
      document.body.appendChild(script);
    </script>
    <div id="audio-div" style="display: none">
        <audio id="audio-playback" crossorigin=anonymous>
            <source id="audio-source" type="audio/ogg" src="">
        </audio>
    </div>
    <div id="video-container">
        <video id="pose-video" class="layer" playsinline></video>
        <canvas id="pose-canvas" class="layer"></canvas>
        <div id="pose-result" class="layer"></div>
    </div>
    <script>
		$('#show-gesture').change(function () {
			if (this.checked) {
				$('#video-container').show();
			} else {
				$('#video-container').hide();
			}
		});

		$('#use-gesture').change(function () {
			if (this.checked) {
				unityInstance.SendMessage("UserHandPoseModule", "EnableModule");
			} else {
				unityInstance.SendMessage("UserHandPoseModule", "DisableModule");
			}
		});

		
        $('#use-key').change(function () {
            if (this.checked) {
            unityInstance.SendMessage("WizardOfOzPush Module", "EnableModule");
            } else {
            unityInstance.SendMessage("WizardOfOzPush Module", "DisableModule");
            }
        });

        $('#show-datastore').change(function () {
            if (this.checked) {
            unityInstance.SendMessage('DataStore Display', 'SetTrue');
            } else {
            unityInstance.SendMessage('DataStore Display', 'SetFalse');
            }
        });


        $('#start-btn').click(function () {
            if ($('#engage-chk').prop('checked') == true) {
            $('#start-btn').html('Resume');
                $("#start-btn").addClass('btn-start');
                $("#start-btn").removeClass('btn-pause');
                unityInstance.SendMessage('EngagementModule', 'SetEngaged', 0);
                $("#engage-chk").prop("checked", false);
            } else {
            $('#start-btn').html('Pause');
                $("#start-btn").removeClass('btn-start');
                $("#start-btn").addClass('btn-pause');
                unityInstance.SendMessage('EngagementModule', 'SetEngaged', 1);
                $("#engage-chk").prop("checked", true);
            }
        });

        $('#sort-btn').click(function () {
            console.log("Sort Button Clicked")
            unityInstance.SendMessage('ChildStudySceneController', 'ChangeScene', 'ChildStudy');
        });

        $('#gesture-btn').click(function () {
            console.log("Gesture Button Clicked")
            unityInstance.SendMessage('ChildStudySceneController', 'ChangeScene', 'ChildStudy_MiniExperiments');
        });

        $('#grooving-btn').click(function () {
            console.log("Grooving Button Clicked")
            unityInstance.SendMessage('ChildStudySceneController', 'ChangeScene', 'ChildStudy_Grooving');
        });
    </script>
</body>
</html>
