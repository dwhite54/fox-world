<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Unity WebGL Player | %UNITY_WEB_NAME%</title>
	<link rel="shortcut icon" href="TemplateData/favicon.ico">
	<link rel="stylesheet" href="TemplateData/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="TemplateData/UnityProgress.js"></script>
	<script src="%UNITY_WEBGL_LOADER_URL%"></script>
	<script src="TemplateData/aws-sdk-2.709.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
	<script src="TemplateData/fingerpose.js" type="text/javascript"></script>
	<script src="TemplateData/fingerpose-adapter.js" type="text/javascript"></script>
	<script>
		//omit "var" so that it's global
		unityInstance = UnityLoader.instantiate("unityContainer", "%UNITY_WEBGL_BUILD_URL%", {
			compatibilityCheck: function (unityInstance, onsuccess, onerror) {
				if (!UnityLoader.SystemInfo.hasWebGL) {
					unityInstance.popup("Your browser does not support WebGL",
						[{ text: "OK", callback: onerror }]);
				} else if (UnityLoader.SystemInfo.mobile) {
					unityInstance.popup("Please note that Unity WebGL is not currently supported on mobiles. Press OK if you wish to continue anyway.",
						[{ text: "OK", callback: onsuccess }]);
				} else if (["Edge", "Firefox", "Chrome", "Safari"].indexOf(UnityLoader.SystemInfo.browser) == -1) {
					unityInstance.popup("Please note that your browser is not currently supported for this Unity WebGL content. Press OK if you wish to continue anyway.",
						[{ text: "OK", callback: onsuccess }]);
				} else {
					onsuccess();
				}
			},
			onProgress: UnityProgress,
			Module: {
				onRuntimeInitialized: startPerception,
			},
		});


	</script>
</head>
<body>
	<div class="webgl-content">
	
		<button type="button" id="start-btn" disabled>Loading...</button><br>
		<input type="checkbox" id="engage-chk" style="display:none;" />
		<label for="show-gesture"><input type="checkbox" id="show-gesture" name="show-gesture" /> Show Video</label>
		<label for="show-datastore"><input type="checkbox" id="show-datastore" name="show-datastore" /> Show Datastore</label>
		<label for="use-gesture"><input type="checkbox" id="use-gesture" name="use-gesture" checked /> Enable Gesture Input</label>
		<label for="use-gesture"><input type="checkbox" id="use-key" name="use-key" checked /> Enable Keyboard Input</label>
		<div id="unityContainer" style="width: %UNITY_WIDTH%px; height: %UNITY_HEIGHT%px"></div>
		<div class="footer">
			<div class="webgl-logo"></div>
			<div class="fullscreen" onclick="unityInstance.SetFullscreen(1)"></div>
			<div class="title">%UNITY_WEB_NAME%</div>
		</div>
		<div class="contact">For questions or comments, contact fortega@colostate.edu</div>
		<div class="controls">If Keyboard Input is enabled, use the Left Arrow Key to send a toy to the left and use the Right Arrow Key to send a toy to the right. Press the Up Arrow Key to wave.</div>
	</div>
	<div id="audio-div" style="display: none">
		<audio id="audio-playback" crossorigin=anonymous>
			<source id="audio-source" type="audio/ogg" src="">
		</audio>
	</div>
	<div id="video-container">
		<video id="pose-video" class="layer" playsinline></video>
		<canvas id="pose-canvas" class="layer"></canvas>
		<div id="pose-result" class="layer"></div>
	</div>
	<script>
		$('#show-gesture').change(function () {
			if (this.checked) {
				$('#video-container').show();
			} else {
				$('#video-container').hide();
			}
		});

		$('#use-gesture').change(function () {
			if (this.checked) {
				unityInstance.SendMessage("UserHandPoseModule", "EnableModule");
			} else {
				unityInstance.SendMessage("UserHandPoseModule", "DisableModule");
			}
		});

		$('#use-key').change(function () {
			if (this.checked) {
				unityInstance.SendMessage("WizardOfOzPush Module", "EnableModule");
			} else {
				unityInstance.SendMessage("WizardOfOzPush Module", "DisableModule");
			}
		});

		$('#show-datastore').change(function () {
			if (this.checked) {
				unityInstance.SendMessage('DataStore Display', 'SetTrue');
			} else {
				unityInstance.SendMessage('DataStore Display', 'SetFalse');
			}
		});


		$('#start-btn').click(function () {
			if ($('#engage-chk').prop('checked') == true) {
				$('#start-btn').html('Resume');
				$("#start-btn").addClass('btn-start');
				$("#start-btn").removeClass('btn-pause');
				unityInstance.SendMessage('EngagementModule', 'SetEngaged', 0);
				$("#engage-chk").prop("checked", false);
			} else {
				$('#start-btn').html('Pause');
				$("#start-btn").removeClass('btn-start');
				$("#start-btn").addClass('btn-pause');
				unityInstance.SendMessage('EngagementModule', 'SetEngaged', 1);
				$("#engage-chk").prop("checked", true);
			}
		});
	</script>
</body>
</html>
